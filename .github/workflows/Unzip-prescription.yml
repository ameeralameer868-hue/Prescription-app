name: ğŸ“¦ ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª

on:
  push:
    paths:
      - '**.zip'
  workflow_dispatch:
    inputs:
      delete_zip:
        description: 'Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ· Ø¨Ø¹Ø¯ Ø§Ù„ÙÙƒØŸ'
        required: true
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      target_folder:
        description: 'Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù'
        required: false
        default: './'
        type: string

jobs:
  extract:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„ÙØ§Øª ZIP
      id: find_zips
      run: |
        echo "Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„ÙØ§Øª ZIP..."
        ZIP_FILES=$(find . -name "*.zip" -type f)
        echo "files=$ZIP_FILES" >> $GITHUB_OUTPUT
        
        if [ -z "$ZIP_FILES" ]; then
          echo "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ZIP!"
          exit 1
        else
          echo "âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª ZIP:"
          echo "$ZIP_FILES"
        fi
    
    - name: ğŸ“‚ ÙÙƒ Ø§Ù„Ø¶ØºØ·
      run: |
        sudo apt install unzip -y
        
        TARGET="${TARGET_FOLDER:-./}"
        
        for zipfile in $(find . -name "*.zip" -type f); do
          echo "ÙÙƒ: $zipfile"
          unzip -o "$zipfile" -d "$TARGET"
          
          DELETE_ZIP="${{ github.event.inputs.delete_zip }}"
          if [ "$DELETE_ZIP" = "true" ] || [ "$DELETE_ZIP" = "" ]; then
            rm -v "$zipfile"
          fi
        done
      env:
        TARGET_FOLDER: ${{ github.event.inputs.target_folder }}
    
    - name: ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        echo "## âœ… Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø¹Ø¯ Ø§Ù„ÙÙƒ:" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        ls -la >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
    
    - name: ğŸš€ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add .
        
        if git diff --staged --quiet; then
          echo "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ø±ÙØ¹Ù‡Ø§"
        else
          git commit -m "ØªÙ„Ù‚Ø§Ø¦ÙŠ: ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø©"
          git push
          echo "âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"
        fi
